/*
 * g.Raphael 0.4 - Charting library, based on RaphaÃ«l
 *
 * Copyright (c) 2009 Dmitry Baranovskiy (http://g.raphaeljs.com)
 * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
 */
Raphael.fn.g.barchart=function(D,B,a,d,R,v){v=v||{};var S={round:"round",sharp:"sharp",soft:"soft"}[v.type]||"square",n=parseFloat(v.gutter||"20%"),P=this.set(),w=this.set(),e=this.set(),t=this.set(),z=Math.max.apply(Math,R),Q=[],c=this,C=0,G=v.colors||this.g.colors,q=R.length,H=v.radius||undefined;if(this.raphael.is(R[0],"array")){z=[];C=q;q=0;for(var M=R.length;M--;){w.push(this.set());var O=Math.abs(Math.max.apply(Math,R[M]));var r=Math.abs(Math.min.apply(Math,R[M]));z.push(Math.max(O,r));q=Math.max(q,R[M].length)}if(v.stacked){for(var M=q;M--;){var l=0;for(var L=R.length;L--;){l+=+R[L][M]||0}Q.push(l)}}for(var M=R.length;M--;){if(R[M].length<q){for(var L=q;L--;){R[M].push(0)}}}z=Math.max.apply(Math,v.stacked?Q:z)}z=(v.to)||z;var E=a/(q*(100+n)+n)*100,b=E*n/100,g=v.vgutter==null?20:v.vgutter,u=[],k=D+b,f=(d-2*g)/z;if(!v.stretch){b=Math.round(b);E=Math.floor(E)}!v.stacked&&(E/=C||1);for(var M=0;M<q;M++){u=[];for(var L=0;L<(C||1);L++){var N=Math.round((C?R[L][M]:R[M])*f),m=B+d-g-N,J=this.g.finger(Math.round(k+E/2),m+N,E,N,true,S,false,H).attr({stroke:G[C?L:M],fill:G[C?L:M]});if(C){w[L].push(J)}else{w.push(J)}J.y=m;J.x=Math.round(k+E/2);J.w=E;J.h=N;J.value=C?R[L][M]:R[M];if(!v.stacked){k+=E}else{u.push(J)}}if(v.stacked){var K;t.push(K=this.rect(u[0].x-u[0].w/2,B,E,d).attr(this.g.shim));K.bars=this.set();var o=0;for(var F=u.length;F--;){u[F].toFront()}for(var F=0,p=u.length;F<p;F++){var J=u[F],A,N=(o+J.value)*f,I=this.g.finger(J.x,B+d-g-!!o*0.5,E,N,true,S,1,H);K.bars.push(J);o&&J.attr({path:I});J.h=N;J.y=B+d-g-!!o*0.5-N;e.push(A=this.rect(J.x-J.w/2,J.y,E,J.value*f).attr(this.g.shim));A.bar=J;A.value=J.value;o+=J.value}k+=E}k+=b}t.toFront();k=D+b;if(!v.stacked){for(var M=0;M<q;M++){for(var L=0;L<(C||1);L++){var A;e.push(A=this.rect(Math.round(k),B+g,E,d-g).attr(this.g.shim));A.bar=C?w[L][M]:w[M];A.value=A.bar.value;k+=E}k+=b}}P.label=function(y,V){y=y||[];V=V==undefined?true:V;this.labels=c.set();var W,h=-Infinity;if(v.stacked){for(var x=0;x<q;x++){var T=0;for(var s=0;s<(C||1);s++){T+=C?R[s][x]:R[x];if(s==0){var X=c.g.labelise(y[s][x],T,z);W=c.g.text(w[s][x].x,V?B+d-g/2:w[s][x].y-10,X);var U=W.getBBox();if(U.x-7<h){W.remove()}else{this.labels.push(W);h=U.x+U.width}}}}}else{for(var x=0;x<q;x++){for(var s=0;s<(C||1);s++){var X=c.g.labelise(C?y[0]&&y[0][x]:y[x],C?R[0][x]:R[x],z);W=c.g.text(w[0][x].x,V?B+d-g/2:w[0][x].y-10,X);var U=W.getBBox();if(U.x-7<h){W.remove()}else{this.labels.push(W);h=U.x+U.width}}}}return this};P.hover=function(i,h){t.hide();e.show();e.mouseover(i).mouseout(h);return this};P.hoverColumn=function(i,h){e.hide();t.show();h=h||function(){};t.mouseover(i).mouseout(h);return this};P.click=function(h){t.hide();e.show();e.click(h);return this};P.each=function(j){if(!Raphael.is(j,"function")){return this}for(var h=e.length;h--;){j.call(e[h])}return this};P.eachColumn=function(j){if(!Raphael.is(j,"function")){return this}for(var h=t.length;h--;){j.call(t[h])}return this};P.clickColumn=function(h){e.hide();t.show();t.click(h);return this};P.push(w,e,t);P.bars=w;P.covers=e;return P};Raphael.fn.g.hbarchart=function(B,z,a,c,N,q){q=q||{};var O={round:"round",sharp:"sharp",soft:"soft"}[q.type]||"square",h=parseFloat(q.gutter||"20%"),L=this.set(),t=this.set(),d=this.set(),o=this.set(),u=Math.max.apply(Math,N),M=[],b=this,A=0,D=q.colors||this.g.colors,m=N.length;if(this.raphael.is(N[0],"array")){u=[];A=m;m=0;for(var J=N.length;J--;){t.push(this.set());var K=Math.abs(Math.max.apply(Math,N[J]));var n=Math.abs(Math.min.apply(Math,N[J]));u.push(Math.max(K,n));m=Math.max(m,N[J].length)}if(q.stacked){for(var J=m;J--;){var g=0;for(var I=N.length;I--;){g+=+N[I][J]||0}M.push(g)}}for(var J=N.length;J--;){if(N[J].length<m){for(var I=m;I--;){N[J].push(0)}}}u=Math.max.apply(Math,q.stacked?M:u)}u=(q.to)||u;var w=Math.floor(c/(m*(100+h)+h)*100),E=Math.floor(w*h/100),p=[],e=z+E,f=(a-1)/u;!q.stacked&&(w/=A||1);for(var J=0;J<m;J++){p=[];for(var I=0;I<(A||1);I++){var r=A?N[I][J]:N[J],G=this.g.finger(B,e+w/2,Math.round(r*f),w-1,false,O).attr({stroke:D[A?I:J],fill:D[A?I:J]});if(A){t[I].push(G)}else{t.push(G)}G.x=B+Math.round(r*f);G.y=e+w/2;G.w=Math.round(r*f);G.h=w;G.value=+r;if(!q.stacked){e+=w}else{p.push(G)}}if(q.stacked){var H=this.rect(B,p[0].y-p[0].h/2,a,w).attr(this.g.shim);o.push(H);H.bars=this.set();var k=0;for(var C=p.length;C--;){p[C].toFront()}for(var C=0,l=p.length;C<l;C++){var G=p[C],v,r=Math.round((k+G.value)*f),F=this.g.finger(B,G.y,r,w-1,false,O,1);H.bars.push(G);k&&G.attr({path:F});G.w=r;G.x=B+r;d.push(v=this.rect(B+k*f,G.y-G.h/2,G.value*f,w).attr(this.g.shim));v.bar=G;k+=G.value}e+=w}e+=E}o.toFront();e=z+E;if(!q.stacked){for(var J=0;J<m;J++){for(var I=0;I<A;I++){var v=this.rect(B,e,a,w).attr(this.g.shim);d.push(v);v.bar=t[I][J];e+=w}e+=E}}L.label=function(T,R){T=T||[];this.labels=b.set();for(var Q=0;Q<m;Q++){for(var P=0;P<A;P++){var y=b.g.labelise(A?T[P]&&T[P][Q]:T[Q],A?N[P][Q]:N[Q],u);var S=R?t[Q*(A||1)+P].x-w/2+3:B+5,x=R?"end":"start",s;this.labels.push(s=b.g.text(S,t[Q*(A||1)+P].y,y).attr({"text-anchor":x}).insertBefore(d[0]));if(s.getBBox().x<B+5){s.attr({x:B+5,"text-anchor":"start"})}else{t[Q*(A||1)+P].label=s}}}return this};L.hover=function(j,i){o.hide();d.show();i=i||function(){};d.mouseover(j).mouseout(i);return this};L.hoverColumn=function(j,i){d.hide();o.show();i=i||function(){};o.mouseover(j).mouseout(i);return this};L.each=function(s){if(!Raphael.is(s,"function")){return this}for(var j=d.length;j--;){s.call(d[j])}return this};L.eachColumn=function(s){if(!Raphael.is(s,"function")){return this}for(var j=o.length;j--;){s.call(o[j])}return this};L.click=function(i){o.hide();d.show();d.click(i);return this};L.clickColumn=function(i){d.hide();o.show();o.click(i);return this};L.push(t,d,o);L.bars=t;L.covers=d;return L};