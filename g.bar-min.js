/*
 * g.Raphael 0.4.1 - Charting library, based on RaphaÃ«l
 *
 * Copyright (c) 2009 Dmitry Baranovskiy (http://g.raphaeljs.com)
 * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
 */
Raphael.fn.g.barchart=function(D,B,a,d,Q,v){v=v||{};var R={round:"round",sharp:"sharp",soft:"soft"}[v.type]||"square",n=parseFloat(v.gutter||"20%"),O=this.set(),w=this.set(),e=this.set(),t=this.set(),z=Math.max.apply(Math,Q),P=[],c=this,C=0,G=v.colors||this.g.colors,q=Q.length;if(this.raphael.is(Q[0],"array")){z=[];C=q;q=0;for(var L=Q.length;L--;){w.push(this.set());var N=Math.abs(Math.max.apply(Math,Q[L]));var r=Math.abs(Math.min.apply(Math,Q[L]));z.push(Math.max(N,r));q=Math.max(q,Q[L].length)}if(v.stacked){for(var L=q;L--;){var l=0;for(var K=Q.length;K--;){l+=+Q[K][L]||0}P.push(l)}}for(var L=Q.length;L--;){if(Q[L].length<q){for(var K=q;K--;){Q[L].push(0)}}}z=Math.max.apply(Math,v.stacked?P:z)}z=(v.to)||z;var E=a/(q*(100+n)+n)*100,b=E*n/100,g=v.vgutter==null?20:v.vgutter,u=[],k=D+b,f=(d-2*g)/z;if(!v.stretch){b=Math.round(b);E=Math.floor(E)}!v.stacked&&(E/=C||1);for(var L=0;L<q;L++){u=[];for(var K=0;K<(C||1);K++){var M=Math.round((C?Q[K][L]:Q[L])*f),m=B+d-g-M,I=this.g.finger(Math.round(k+E/2),m+M,E,M,true,R).attr({stroke:"none",fill:G[C?K:L]});if(C){w[K].push(I)}else{w.push(I)}I.y=m;I.x=Math.round(k+E/2);I.w=E;I.h=M;I.value=C?Q[K][L]:Q[L];if(!v.stacked){k+=E}else{u.push(I)}}if(v.stacked){var J;t.push(J=this.rect(u[0].x-u[0].w/2,B,E,d).attr(this.g.shim));J.bars=this.set();var o=0;for(var F=u.length;F--;){u[F].toFront()}for(var F=0,p=u.length;F<p;F++){var I=u[F],A,M=(o+I.value)*f,H=this.g.finger(I.x,B+d-g-!!o*0.5,E,M,true,R,1);J.bars.push(I);o&&I.attr({path:H});I.h=M;I.y=B+d-g-!!o*0.5-M;e.push(A=this.rect(I.x-I.w/2,I.y,E,I.value*f).attr(this.g.shim));A.bar=I;A.value=I.value;o+=I.value}k+=E}k+=b}t.toFront();k=D+b;if(!v.stacked){for(var L=0;L<q;L++){for(var K=0;K<(C||1);K++){var A;e.push(A=this.rect(Math.round(k),B+g,E,d-g).attr(this.g.shim));A.bar=C?w[K][L]:w[L];A.value=A.bar.value;k+=E}k+=b}}O.label=function(y,U){y=y||[];U=U==undefined?true:U;this.labels=c.set();var V,h=-Infinity;if(v.stacked){for(var x=0;x<q;x++){var S=0;for(var s=0;s<(C||1);s++){S+=C?Q[s][x]:Q[x];if(s==0){var W=c.g.labelise(y[s][x],S,z);V=c.g.text(w[s][x].x,U?B+d-g/2:w[s][x].y-10,W);var T=V.getBBox();if(T.x-7<h){V.remove()}else{this.labels.push(V);h=T.x+T.width}}}}}else{for(var x=0;x<q;x++){for(var s=0;s<(C||1);s++){var W=c.g.labelise(C?y[0]&&y[0][x]:y[x],C?Q[0][x]:Q[x],z);V=c.g.text(w[0][x].x,U?B+d-g/2:w[0][x].y-10,W);var T=V.getBBox();if(T.x-7<h){V.remove()}else{this.labels.push(V);h=T.x+T.width}}}}return this};O.hover=function(i,h){t.hide();e.show();e.mouseover(i).mouseout(h);return this};O.hoverColumn=function(i,h){e.hide();t.show();h=h||function(){};t.mouseover(i).mouseout(h);return this};O.click=function(h){t.hide();e.show();e.click(h);return this};O.each=function(j){if(!Raphael.is(j,"function")){return this}for(var h=e.length;h--;){j.call(e[h])}return this};O.eachColumn=function(j){if(!Raphael.is(j,"function")){return this}for(var h=t.length;h--;){j.call(t[h])}return this};O.clickColumn=function(h){e.hide();t.show();t.click(h);return this};O.push(w,e,t);O.bars=w;O.covers=e;return O};Raphael.fn.g.hbarchart=function(n,l,B,w,c,r){r=r||{};var e={round:"round",sharp:"sharp",soft:"soft"}[r.type]||"square",f=parseFloat(r.gutter||"20%"),u=this.set(),A=this.set(),h=this.set(),E=this.set(),M=Math.max.apply(Math,c),a=[],o=this,C=0,m=r.colors||this.g.colors,H=c.length;if(this.raphael.is(c[0],"array")){M=[];C=H;H=0;for(var G=c.length;G--;){A.push(this.set());M.push(Math.max.apply(Math,c[G]));H=Math.max(H,c[G].length)}if(r.stacked){for(var G=H;G--;){var p=0;for(var F=c.length;F--;){p+=+c[F][G]||0}a.push(p)}}for(var G=c.length;G--;){if(c[G].length<H){for(var F=H;F--;){c[G].push(0)}}}M=Math.max.apply(Math,r.stacked?a:M)}M=(r.to)||M;var J=Math.floor(w/(H*(100+f)+f)*100),k=Math.floor(J*f/100),g=[],b=l+k,d=(B-1)/M;!r.stacked&&(J/=C||1);for(var G=0;G<H;G++){g=[];for(var F=0;F<(C||1);F++){var L=C?c[F][G]:c[G],I=this.g.finger(n,b+J/2,Math.round(L*d),J-1,false,e).attr({stroke:"none",fill:m[C?F:G]});if(C){A[F].push(I)}else{A.push(I)}I.x=n+Math.round(L*d);I.y=b+J/2;I.w=Math.round(L*d);I.h=J;I.value=+L;if(!r.stacked){b+=J}else{g.push(I)}}if(r.stacked){var q=this.rect(n,g[0].y-g[0].h/2,B,J).attr(this.g.shim);E.push(q);q.bars=this.set();var v=0;for(var t=g.length;t--;){g[t].toFront()}for(var t=0,D=g.length;t<D;t++){var I=g[t],K,L=Math.round((v+I.value)*d),z=this.g.finger(n,I.y,L,J-1,false,e,1);q.bars.push(I);v&&I.attr({path:z});I.w=L;I.x=n+L;h.push(K=this.rect(n+v*d,I.y-I.h/2,I.value*d,J).attr(this.g.shim));K.bar=I;v+=I.value}b+=J}b+=k}E.toFront();b=l+k;if(!r.stacked){for(var G=0;G<H;G++){for(var F=0;F<(C||1);F++){var K=this.rect(n,b,B,J).attr(this.g.shim);h.push(K);K.bar=C?A[F][G]:A[G];K.value=K.bar.value;b+=J}b+=k}}u.label=function(R,P){R=R||[];this.labels=o.set();for(var O=0;O<H;O++){for(var N=0;N<C;N++){var y=o.g.labelise(C?R[N]&&R[N][O]:R[O],C?c[N][O]:c[O],M);var Q=P?A[O*(C||1)+N].x-J/2+3:n+5,x=P?"end":"start",s;this.labels.push(s=o.g.text(Q,A[O*(C||1)+N].y,y).attr({"text-anchor":x}).insertBefore(h[0]));if(s.getBBox().x<n+5){s.attr({x:n+5,"text-anchor":"start"})}else{A[O*(C||1)+N].label=s}}}return this};u.hover=function(j,i){E.hide();h.show();i=i||function(){};h.mouseover(j).mouseout(i);return this};u.hoverColumn=function(j,i){h.hide();E.show();i=i||function(){};E.mouseover(j).mouseout(i);return this};u.each=function(s){if(!Raphael.is(s,"function")){return this}for(var j=h.length;j--;){s.call(h[j])}return this};u.eachColumn=function(s){if(!Raphael.is(s,"function")){return this}for(var j=E.length;j--;){s.call(E[j])}return this};u.click=function(i){E.hide();h.show();h.click(i);return this};u.clickColumn=function(i){h.hide();E.show();E.click(i);return this};u.push(A,h,E);u.bars=A;u.covers=h;return u};