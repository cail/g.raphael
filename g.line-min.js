/*
 * g.Raphael 0.4.1 - Charting library, based on RaphaÃ«l
 *
 * Copyright (c) 2009 Dmitry Baranovskiy (http://g.raphaeljs.com)
 * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
 */
Raphael.fn.g.linechart=function(O,N,a,c,s,r,G){function F(x,ae){var v=x.length/ae,y=0,i=v,Y=0,X=[];while(y<x.length){i--;if(i<0){Y+=x[y]*(1+i);X.push(Y/v);Y=x[y++]*-i;i+=v}else{Y+=x[y++]}}return X}G=G||{};if(!this.raphael.is(s[0],"array")){s=[s]}if(!this.raphael.is(r[0],"array")){r=[r]}var U=Array.prototype.concat.apply([],s),S=Array.prototype.concat.apply([],r),o=this.g.snapEnds(Math.min.apply(Math,U),Math.max.apply(Math,U),s[0].length-1),z=G.minx!==undefined?G.minx:o.from,h=G.maxx!==undefined?G.maxx:o.to,l=G.gutter!==undefined?G.gutter:10,V=(a-l*2)/(h-z),L=this.g.snapEnds(Math.min.apply(Math,S),Math.max.apply(Math,S),r[0].length-1),w=G.miny!==undefined?G.miny:L.from,g=G.maxy!==undefined?G.maxy:L.to,T=(c-l*2)/(g-w),u=Math.max(s[0].length,r[0].length),n=G.symbol||"",Q=G.colors||Raphael.fn.g.colors,M=this,p=null,k=null,ab=this.set(),R=[];if(w==g){w--;g++;T=(c-l*2)/(g-w)}for(var aa=0,J=r.length;aa<J;aa++){u=Math.max(u,r[aa].length)}var ad=this.set();for(var aa=0,J=r.length;aa<J;aa++){if(r[aa].length>a-2*l){r[aa]=F(r[aa],a-2*l);u=a-2*l}if(s[aa]&&s[aa].length>a-2*l){s[aa]=F(s[aa],a-2*l)}}var C=this.set();if(G.axis){if(G.x_spacing){G.axisxstep=(h-z)/G.x_spacing}if(G.y_spacing){G.axisystep=(g-w)/G.y_spacing}var f=(G.axis+"").split(/[,\s]+/);+f[0]&&C.push(this.g.axis(O+l,N+l,a-2*l,z,h,G.axisxstep||Math.floor((a-2*l)/20),2,G.labels&&G.labels[0]));+f[1]&&C.push(this.g.axis(O+a-l,N+c-l,c-2*l,w,g,G.axisystep||Math.floor((c-2*l)/20),3,G.labels&&G.labels[1]));+f[2]&&C.push(this.g.axis(O+l,N+c-l,a-2*l,z,h,G.axisxstep||Math.floor((a-2*l)/20),0,G.labels&&G.labels[2]));+f[3]&&C.push(this.g.axis(O+l,N+c-l,c-2*l,w,g,G.axisystep||Math.floor((c-2*l)/20),1,G.labels&&G.labels[3]))}var K=this.set(),W=this.set(),m;for(var aa=0,J=r.length;aa<J;aa++){if(!G.nostroke){K.push(m=this.path().attr({stroke:Q[aa],"stroke-width":G.width||2,"stroke-linejoin":"round","stroke-linecap":"round","stroke-dasharray":G.dash||""}))}var b=this.raphael.is(n,"array")?n[aa]:n,D=this.set();R=[];var H={x:-1,y:-1};var B=function(x,v){return O+l+((s[x]||s[0])[v]-z)*V};var A=function(x,v){return N+c-l-(r[x][v]-w)*T};for(var Z=0,q=r[aa].length;Z<q;Z++){var e=B(aa,Z);var d=A(aa,Z);(Raphael.is(b,"array")?b[Z]:b)&&D.push(this.g[Raphael.fn.g.markers[this.raphael.is(b,"array")?b[Z]:b]](e,d,(G.width||2)*3).attr({fill:Q[aa],stroke:"none"}));if(!G.interpolate){R=R.concat([Z?"L":"M",e,d])}else{if(Z==0){R=R.concat(["M",e,d])}else{var ac={x:0,y:0};if(Z!=0){var P={y:d-H.y,x:e-H.x};var ac=Math.atan2(P.y,P.x);var u=Math.sqrt(P.x*P.x+P.y*P.y)*(G.length_adapt||0.2);if(Z<q-1){var t={y:A(aa,Z+1)-d,x:B(aa,Z+1)-e};ac=ac+(Math.atan2(t.y,t.x)-ac)*(G.angle_adapt||0.5)}}R=R.concat(["S",e-u*Math.cos(ac),d-u*Math.sin(ac),e,d])}}H.x=e;H.y=d}W.push(D);if(G.shade){ad.push(this.path().attr({stroke:"none",fill:Q[aa],opacity:G.nostroke?1:0.3,path:R.concat(["L",e,N+c-l,"L",O+l+((s[aa]||s[0])[0]-z)*V,N+c-l,"z"]).join(",")}))}!G.nostroke&&m.attr({path:R.join(",")})}function I(ak){var ah=[];for(var ai=0,am=s.length;ai<am;ai++){ah=ah.concat(s[ai])}ah.sort(function(j,i){return j-i});var an=[],ae=[];for(var ai=0,am=ah.length;ai<am;ai++){ah[ai]!=ah[ai-1]&&an.push(ah[ai])&&ae.push(O+l+(ah[ai]-z)*V)}ah=an;am=ah.length;var Y=ak||M.set();for(var ai=0;ai<am;ai++){var y=ae[ai]-(ae[ai]-(ae[ai-1]||O))/2,al=((ae[ai+1]||O+a)-ae[ai])/2+(ae[ai]-(ae[ai-1]||O))/2,v;ak?(v={}):Y.push(v=M.rect(y-1,N,Math.max(al+1,1),c).attr({stroke:"none",fill:"#000",opacity:0}));v.values=[];v.symbols=M.set();v.y=[];v.x=ae[ai];v.axis=ah[ai];v.valuex=ah[ai];for(var ag=0,aj=r.length;ag<aj;ag++){an=s[ag]||s[0];for(var af=0,x=an.length;af<x;af++){if(an[af]==ah[ai]){v.values.push(r[ag][af]);v.y.push(N+c-l-(r[ag][af]-w)*T);v.symbols.push(ab.symbols[ag][af])}}}ak&&ak.call(v)}!ak&&(p=Y)}function E(ai){var ae=ai||M.set(),v;for(var ag=0,ak=r.length;ag<ak;ag++){for(var af=0,ah=r[ag].length;af<ah;af++){var y=O+l+((s[ag]||s[0])[af]-z)*V,aj=O+l+((s[ag]||s[0])[af?af-1:1]-z)*V,x=N+c-l-(r[ag][af]-w)*T;ai?(v={}):ae.push(v=M.circle(y,x,Math.abs(aj-y)/2).attr({stroke:"none",fill:"#000",opacity:0}));v.x=y;v.y=x;v.value=r[ag][af];v.line=ab.lines[ag];v.shade=ab.shades[ag];v.symbol=ab.symbols[ag][af];v.symbols=ab.symbols[ag];v.axis=(s[ag]||s[0])[af];ai&&ai.call(v)}}!ai&&(k=ae)}ab.push(K,ad,W,C,p,k);ab.lines=K;ab.shades=ad;ab.symbols=W;ab.axis=C;ab.valuesx=s;ab.valuesy=r;ab.hoverColumn=function(j,i){!p&&I();p.mouseover(j).mouseout(i);return this};ab.clickColumn=function(i){!p&&I();p.click(i);return this};ab.hrefColumn=function(X){var Y=M.raphael.is(arguments[0],"array")?arguments[0]:arguments;if(!(arguments.length-1)&&typeof X=="object"){for(var j in X){for(var v=0,y=p.length;v<y;v++){if(p[v].axis==j){p[v].attr("href",X[j])}}}}!p&&I();for(var v=0,y=Y.length;v<y;v++){p[v]&&p[v].attr("href",Y[v])}return this};ab.hover=function(j,i){!k&&E();k.mouseover(j).mouseout(i);return this};ab.click=function(i){!k&&E();k.click(i);return this};ab.each=function(i){E(i);return this};ab.eachColumn=function(i){I(i);return this};return ab};